<!doctype html>
<html lang="en">

	<head>

		<title>Lab08 Solution: Spritesheet Walking No. 2</title>

		<script type="text/javascript" src="raf.js"></script>
		<script type="text/javascript">
			var can, ctx;
			var count = 0;
		
			//var x, y;
			var dx, dy;
			var vx, vy;

			//variables are used to slow down animation
			var sloMoCounter = 0;
			var sloMoRate = 4;
			
			var motion="right";
			var walkImg = new Image();
			var frameW = 32;
			var frameH = 51;

			var curAnim, curFrames, curVel;
			var character1; //will contain the object for character1 walking;

			//NOTE:
			//don't use img.onload events to start animation
			//because local images load before the canvas and context is created.
			//image is 194 h & 204 w

			walkImg.src = "characters.png";

			char1Walk = new Object();
			char1Walk.static = {frames: [{x:32,y:0}], velocity : {vx:0, vy: 0}};
			char1Walk.down = {frames: [{x:0,y:0},{x:32,y:0},{x:64,y:0}], velocity : {vx:0, vy: 1}};
			char1Walk.left = {frames: [{x:0,y:51},{x:32,y:51},{x:64,y:51}], velocity : {vx:-1, vy: 0}};
			char1Walk.right = {frames: [{x:0,y:102},{x:32,y:102},{x:64,y:102}], velocity : {vx:1, vy: 0}};
			char1Walk.up =  {frames: [{x:0,y:153},{x:32,y:153},{x:64,y:153}], velocity : {vx:0, vy: -1}};

			char1Walk.returnAnim =  function(str) {
				//returns entire objes
				//return this[str];
				// returns frames
				return this[str].frames;
			};
			char1Walk.returnVelocity =  function(str) {
				//returns entire objes
				//return this[str];
				// returns frames
				return this[str].velocity;
			};

			function init() {
				console.log("hello init");
				can =  document.getElementById("canvas")
				ctx =  can.getContext("2d");
				count = 0;
				dx = can.width/2;
				dy = can.height/2;
				char1Draw();
				// drawLoop();
			};
			// to draw 2 characters - only one request possible
				function drawLoop(){
						myAnimation = requestAnimationFrame(char1Draw);
						char1Draw();
						char2Draw();
				}

			function char1Draw(){
				//clear the rectangle of previous frame	
				ctx.clearRect(0, 0, can.width, can.height);
				character1 = requestAnimationFrame(char1Draw);
	                //get the animation info from the char1Walk object
					curAnim = char1Walk.returnAnim(motion);
					//get the frames info of the current Animation
	                curFrames = curAnim.frames;
					//get cutOut coordinates from curFrames Array
	             	xSource = curAnim[count].x;
	                ySource = curAnim[count].y;
	                	

	                //get Velocity info from curAnim object
	                curVel = char1Walk.returnVelocity;
	                vx = curVel.vx;
	               	vy = curVel.vy;  

	               	dx+=vx;
	               	dy+=vy;                 
                //finally draw the frame of the animation to the canvas
				ctx.drawImage(walkImg, xSource, ySource, frameW, frameH, dx, dy, frameW, frameH);	

                //slowMo Counter slows down the Animation
                //necessary because otherwise the 3 frames will flash
                //too quickly
                //this tests resets count back to 0 if it exceeds the number of frames
                if (sloMoCounter == sloMoRate){
                	if(count == curAnim.length-1){
                		count = 0;
                	} else{
                		count++;
                	}
                	sloMoCounter = 0;
                }
                sloMoCounter++;
			}


		</script>
		<style>
		 canvas{ background:url(background.jpg)}
		</style>
	</head>

	<body onload="init()"   onkeydown="checkKeys(event)">

		<canvas id="canvas" width="800" height="500">
			Canvas is not supported
		</canvas>

	</body>

</html>