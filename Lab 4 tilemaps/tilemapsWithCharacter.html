<!doctype html>
<html lang="en">
	<head>
		<title>Spritesheet Walking No. 2</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<script type="text/javascript" src="raf.js"></script>
		<script type="text/javascript">
			var canvas, context;
			var levelCols=11;							// level width, in tiles
			var levelRows=9;							// level height, in tiles
			var tileSize=64;							// tile size, in pixels
			var can, ctx;
			var count = 0;
			var dx, dy, dx2, dy2;
			var vx, vy, vx2, vy2;
			//variables are used to slow down animation
			var sloMoCounter = 0;
			var sloMoRate = 4;
			var motion="static";
			var walkImg = new Image();
			var frameW = 32;
			var frameH = 51;
			var curAnim, curAnim2, curFrames, curVel, curVel2;
			var character;
			var character1;
			var character2; //will contain the object for character1 walking;
			var char1Walk, char2Walk;
			walkImg.src = "../Lab 3 spritesheet/characters.png";
			// character 1
			char1Walk = new Object();
			char1Walk.static = {frames: [{x:32,y:0}], velocity : {vx:0, vy: 0}};
			char1Walk.down = {frames: [{x:0,y:0},{x:32,y:0},{x:64,y:0}], velocity : {vx:0, vy: 1}};
			char1Walk.left = {frames: [{x:0,y:51},{x:32,y:51},{x:64,y:51}], velocity : {vx:-1, vy: 0}};
			char1Walk.right = {frames: [{x:0,y:102},{x:32,y:102},{x:64,y:102}], velocity : {vx:1, vy: 0}};
			char1Walk.up =  {frames: [{x:0,y:153},{x:32,y:153},{x:64,y:153}], velocity : {vx:0, vy: -1}};
			char1Walk.returnAnim =  function(str) {
				//returns entire objcts ---- return this[str];
				// returns frames
				return this[str].frames;
			};
			char1Walk.returnVelocity =  function(str) {
				return this[str].velocity;
			};

			// character 2
			char2Walk = new Object();
			char2Walk.static = {frames: [{x:96,y:0}], velocity : {vx:0, vy: 0}};
			char2Walk.down = {frames: [{x:96,y:0},{x:128,y:0},{x:160,y:0}], velocity : {vx:0, vy: 1}};
			char2Walk.left = {frames: [{x:96,y:51},{x:128,y:51},{x:160,y:51}], velocity : {vx:-1, vy: 0}};
			char2Walk.right = {frames: [{x:96,y:153},{x:128,y:153},{x:160,y:153}], velocity : {vx:1, vy: 0}};
			char2Walk.up =  {frames: [{x:96,y:102},{x:128,y:102},{x:160,y:102}], velocity : {vx:0, vy: -1}};
			//functions to return frames and velocity
			char2Walk.returnAnim =  function(str) {
				//returns entire objcts ---- return this[str];
				// returns frames
				return this[str].frames;
			};
			char2Walk.returnVelocity =  function(str) {
				return this[str].velocity;
			};


			function init() {
				canvas =  document.getElementById("canvas");
				context = canvas.getContext("2d");
					count = 0;
					dx = canvas.width/2;
					dy = canvas.height/2;
					dx2 = 20;
					dy2 = 150;
					drawLoop();

					var level = [        						// the 11x9 level - 1=wall, 0=empty space
						[1,1,1,1,1,1,1,1,1,1,1],
						[1,0,0,0,0,0,0,0,0,1,1],
						[1,0,0,1,0,0,0,0,0,0,1],
						[1,0,0,0,1,0,1,0,0,0,1],
						[1,0,0,0,0,0,0,0,0,0,1],
						[1,0,0,0,1,0,1,0,0,0,1],
						[1,0,0,0,0,0,0,0,0,0,1],
						[1,1,0,0,0,0,0,0,0,1,1],
						[1,1,1,1,1,1,1,1,1,1,1]
					];

			};

		// function to display the level
		function renderLevel(){
			// clear the canvas
			context.clearRect(0, 0, canvas.width, canvas.height);
			// walls = red boxes
			context.fillStyle = "#ffff00";
			for(i=0;i<levelRows;i++){
				for(j=0;j<levelCols;j++){
					if(level[i][j]==1){
						context.fillRect(j*tileSize,i*tileSize,tileSize,tileSize);	
					}
				}
			}
			// player = green box
			context.fillStyle = "#00ff00";

			context.save();
		//	context.translate(playerXPos +10, playerYPos + 10  );
			context.fillRect(0,0,tileSize-20,tileSize-20);
			context.restore();
		}
		// to draw 2 characters - only one request possible
			function drawLoop(){		
				myAnimation = requestAnimationFrame(drawLoop);
				context.clearRect(0, 0, canvas.width, canvas.height);		
				char1Draw();
				char2Draw();
				//slowMo Counter slows down the Animation
                //necessary because otherwise the 3 frames will flash too quickly
                //this tests resets count back to 0 if it exceeds the number of frames
                if (sloMoCounter == sloMoRate){
                	if(count == curAnim.length-1){
                		count = 0;
                	} else{
                		count++;
                	}
                	sloMoCounter = 0;
                }
                sloMoCounter++;
			}
			// character 1
			function char1Draw(){
                //get the animation info from the char1Walk object
				curAnim = char1Walk.returnAnim(motion);
				//get the frames info of the current Animation  -- frames coordinates
             	var xSource = curAnim[count].x;
                var ySource = curAnim[count].y;
				//curVel = curAnim.velocity
                //get Velocity info from curAnim object
                curVel = char1Walk.returnVelocity(motion);
                vx = curVel.vx;
               	vy = curVel.vy;  
               	dx+=vx;
               	dy+=vy;                 
                //finally draw the frame of the animation to the canvas
				ctx.drawImage(walkImg, xSource, ySource, frameW, frameH, dx, dy, frameW, frameH);      
			}
			// character 2
			function char2Draw(){
				curAnim2 = char2Walk.returnAnim(motion);
				var xSource2 = curAnim2[count].x;
                var ySource2 = curAnim2[count].y;
                curVel2 = char2Walk.returnVelocity(motion);
                vx2 = curVel2.vx;
               	vy2 = curVel2.vy; 
               	dx2 += vx2;
               	dy2 += vy2;
               	ctx.drawImage(walkImg, xSource2, ySource2, frameW, frameH, dx2+50, dy2+100, frameW, frameH);
			}
			// switch statement for keys pressed
			function checkKeys(e){
				var keyPressed = e.keyCode;
				console.log(keyPressed);
				// reser count
				count = 0;
				switch(keyPressed){
					case(37):
						motion = "left";
						break;
					case(39):
						motion = "right";
						break;
					case(38):
						motion = "up";
						break;
					case(40):
						motion = "down";
						break;	
					default:
						console.log("default key");
						motion = "static";
				}
			}
	
		</script>
		<style>
		 
		</style>
	</head>
	<body onload="init()" onkeydown="checkKeys(event)">
		<canvas id="canvas" width="800" height="1000">
			Canvas is not supported
		</canvas>
	</body>
</html>